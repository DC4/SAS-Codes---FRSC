
			*******************************************************************
					 HR_MID_Amount_NonMajor_Test Global Credit

			*******************************************************************;

LIBNAME CR "C:\Users\1510806\OneDrive - Standard Chartered Bank\Desktop\Jhilam\Consolidated Last 3 Months Data\Nov21_Major\MAJOR_COUNTRIES_DATA";
LIBNAME INC "C:\Users\1510806\OneDrive - Standard Chartered Bank\Desktop\Jhilam\Daily Data\CR";

DATA  FALT002;
SET 
INC.falt002_cr_03dec
INC.falt002_cr_04dec;   

WHERE  CRD_CLNT_ID NOT IN ("SC_CCMSHK_CR" "SC_PMTHK_CR" "SC_CCMSTW_CR" "SC_C400BD_CR" 
"SC_C400AE_CR"  "SC_CCMSMY_CR"  "SC_CCMSIN_CR"  "SC_CCMSSG_CR")  and 
TRN_AUTH_POST = "A" and AUTH_DECISION_XCD = "A" and TRN_TYP IN  ("C" "M" "P");
FORMAT TRAN_DATE DATE9.;
 TRAN_DATE = INPUT(SUBSTR(TRN_DT,1,2) || SUBSTR(TRN_DT,4,3) || '20' || SUBSTR(TRN_DT,8,2),DATE9.);
 ATTRIB AUTH_DTTM FORMAT=DATETIME19.;
 AUTH_DTTM=DHMS(TRAN_DATE,SUBSTR(TRN_DT,11,2),SUBSTR(TRN_DT,14,2),SUBSTR(TRN_DT,17,2)); 
 MCC = INPUT(SIC_CD,BEST.);

		IF SUBSTR(ACCT_NBR,1,6) IN ('411144'
								'421451'
								'469626'
								'470691') AND CRD_CLNT_ID = "SC_SPARROWBD_DB" THEN TRN_AMT_LOCAL = TRN_AMT * 83.60;
	ELSE TRN_AMT_LOCAL = TRN_AMT;

		IF CRD_CLNT_ID = "SC_EURONETAE_DB" THEN USD = TRN_AMT/3.67;
		ELSE IF CRD_CLNT_ID = "SC_EURONETMY_DB" THEN USD= TRN_AMT/3.221743;
		ELSE IF CRD_CLNT_ID = "SC_EURONETID_DB" THEN USD= TRN_AMT/13500;
		ELSE IF CRD_CLNT_ID = "SC_EURONETIN_DB" THEN USD= TRN_AMT/65;
		ELSE IF CRD_CLNT_ID = "SC_TANDEMTW_DB" THEN USD= TRN_AMT/30.116853; 
		ELSE IF CRD_CLNT_ID = "SC_EURONETBH_DB" THEN USD= TRN_AMT/0.377132; 
		ELSE IF CRD_CLNT_ID = "SC_SPARROWBW_DB" THEN USD= TRN_AMT/10.2587; 
		ELSE IF CRD_CLNT_ID = "SC_SPARROWGH_DB" THEN USD= TRN_AMT/4.42718; 
		ELSE IF CRD_CLNT_ID = "SC_SPARROWJO_DB" THEN USD= TRN_AMT/0.708893; 
		ELSE IF CRD_CLNT_ID = "SC_SPARROWKE_DB" THEN USD= TRN_AMT/103.824; 
		ELSE IF CRD_CLNT_ID = "SC_SPARROWLK_DB" THEN USD= TRN_AMT/153.05; 
		ELSE IF CRD_CLNT_ID = "SC_SPARROWNG_DB" THEN USD= TRN_AMT/365.467; 
		ELSE IF CRD_CLNT_ID = "SC_SPARROWNP_DB" THEN USD= TRN_AMT/102.69; 
		ELSE IF CRD_CLNT_ID = "SC_EURONETVN_DB" THEN USD= TRN_AMT/22700; 
		ELSE IF CRD_CLNT_ID = "SC_SPARROWZM_DB" THEN USD= TRN_AMT/8.98193; 
		ELSE IF CRD_CLNT_ID IN ("SC_EURONETBN_DB"  "SC_EURONETSG_DB") THEN USD= TRN_AMT/1.36370; 
		ELSE IF CRD_CLNT_ID = "SC_SPARROWBW_DB" THEN USD= TRN_AMT/10.3382; 
		ELSE IF CRD_CLNT_ID = "SC_SPARROWGM_DB" THEN USD= TRN_AMT/45.8258; 
		ELSE IF CRD_CLNT_ID = "SC_EURONETIN_DB" THEN USD= TRN_AMT/65; 
		ELSE IF CRD_CLNT_ID = "SC_EURONETQA_DB" THEN USD= TRN_AMT/3.64146; 
		ELSE IF CRD_CLNT_ID = "SC_SPARROWTZ_DB" THEN USD= TRN_AMT/2240.11; 
		ELSE IF CRD_CLNT_ID = "SC_SPARROWUG_DB" THEN USD= TRN_AMT/3603.55; 
		ELSE IF CRD_CLNT_ID = "SC_SPARROWZW_DB" THEN USD= TRN_AMT/361.900; 
		ELSE IF CRD_CLNT_ID = "SC_HOGANHK_DB" THEN USD= TRN_AMT/7.8;
		ELSE IF CRD_CLNT_ID = "SC_SPARROWBD_DB" THEN USD = TRN_AMT_LOCAL/83.60;
		ELSE IF CRD_CLNT_ID = "SC_SPARROWCI_DB" THEN USD = TRN_AMT/562.55;
		ELSE IF CRD_CLNT_ID = "SC_SPARROWCM_DB" THEN USD = TRN_AMT/570;
		ELSE IF CRD_CLNT_ID = "SC_SPARROWSL_DB" THEN USD = TRN_AMT/8300;

RUN;

PROC SORT DATA=FALT002 OUT=FALT002_1 NODUPKEY; BY FI_TRANSACTION_ID; RUN;

PROC SORT DATA=FALT002_1 OUT=FALT002_2 ; BY ACCT_NBR AUTH_DTTM; RUN;


DATA TXN_DATA_SAS;
SET FALT002_2;
IF
(
(
 TRN_AUTH_POST  = "A" AND
 AUTH_DECISION_XCD  = "A" AND
 TRN_TYP  IN ("C" "M" "P")
)
and
(
(
 CRD_CLNT_ID  NOT IN ("SC_C400AE_CR"  "SC_CCMSMY_CR"  "SC_CCMSIN_CR"  "SC_CCMSSG_CR") AND
(
(COMPRESS(MER_ID) = "145456887" AND  USD  >= 40) OR
(COMPRESS(MER_ID) = "24633695" AND  USD  >= 40) OR
(COMPRESS(MER_ID) = "4556359848" AND  USD  >= 20) OR
(COMPRESS(MER_ID) = "4556487655" AND  USD  >= 45) OR
(COMPRESS(MER_ID) = "165860000000001" AND  USD  > 800) OR
(COMPRESS(MER_ID) = "100000000004080" AND  USD  > 450) OR
(COMPRESS(MER_ID) = "211089000206215" AND  FRD_SCOR  > 450) OR
(COMPRESS(MER_ID) = "1010145114652" AND  FRD_SCOR  > 350) OR
(COMPRESS(MER_ID) = "PKIIEZJC9RHBRA1" AND  FRD_SCOR  >= 950) OR
(COMPRESS(MER_ID) = "100000000036476" AND  FRD_SCOR  >= 150) OR
(COMPRESS(MER_ID) = "000980020077999" AND  FRD_SCOR  <= 200 AND USD >= 900) OR
(COMPRESS(MER_ID) = "395700028310" AND USD >= 50)
)
)

OR
(
 CRD_CLNT_ID  = "SC_C400BH_CR" AND
(
(COMPRESS(MER_ID) = "000445120538993" AND  FRD_SCOR  >= 450 AND USD >= 100) OR
(COMPRESS(MER_ID) = "000445120538993" AND  INDEX(UPCASE(MER_NM),"THEBLUEHERO CLUB") AND
USD >= 100) OR
(COMPRESS(MER_ID) = "250684000246651" AND USD >= 50) OR
(COMPRESS(MER_ID) = "4445900009920" AND USD >=100) OR
(COMPRESS(MER_ID) = "80001701" AND USD >=400) OR
(COMPRESS(MER_ID) = "547020000200402" AND USD >= 75) OR
(COMPRESS(MER_ID) = "000445577887992" AND  FRD_SCOR  >=150) OR
(COMPRESS(MER_ID) = "27415395" AND USD >= 10) OR
(MER_ID = "FREE MOBILE" AND USD >= 50) OR
(COMPRESS(MER_ID) = "000445357502993" AND USD >= 100) OR
(COMPRESS(MER_ID) = "576600000003231" AND USD >= 600 AND  FRD_SCOR  >= 300) OR
(COMPRESS(MER_ID) = "04591943" AND  FRD_SCOR  >= 600) OR
(COMPRESS(MER_ID) = "990000028481" AND  FRD_SCOR  >= 700) OR
(COMPRESS(MER_ID) = "1RFNZA2LQJB6WTZ" AND USD >= 50 AND  FRD_SCOR  >= 100)
)
)

OR
(
 CRD_CLNT_ID  = "SC_C400JE_CR" AND
(
(COMPRESS(MER_ID) = "000445120538993" AND  FRD_SCOR  > 50 AND USD >= 100) OR
(COMPRESS(MER_ID) = "345829100000000" AND  FRD_SCOR  >=250 )
)
)

OR
(
 CRD_CLNT_ID  = "SC_C400VN_CR" AND
(
(COMPRESS(MER_ID) = "259258000067204" AND  USD  >= 30) OR
(COMPRESS(MER_ID) = "000100700028046" AND  FRD_SCOR  >=300 ) OR
(COMPRESS(MER_ID) = "268128000209351" AND  FRD_SCOR  >=800 )
)
)

OR
(
 CRD_CLNT_ID  = "SC_CCMSID_CR" AND
(
(COMPRESS(MER_ID) = "0001000210" AND  FRD_SCOR  >= 300) OR
(COMPRESS(MER_ID) = "000345031502882" AND USD >= 50) OR
(COMPRESS(MER_ID) = "140004960209628" AND USD >=600) OR
(COMPRESS(MER_ID) = "498750000022153" AND USD >=600) OR
(COMPRESS(MER_ID) = "VG9TROJX9AN0LJJ" AND  FRD_SCOR  >= 500) OR
(COMPRESS(MER_ID) = "100710001249" AND  FRD_SCOR  >= 300)
)
)

OR
(
 CRD_CLNT_ID  = "SC_C400KE_CR" AND
(
(COMPRESS(MER_ID) ="298803000103177" AND  FRD_SCOR  >=250) OR
(COMPRESS(MER_ID) ="84584868" AND USD >=40) OR
(COMPRESS(MER_ID) ="000000000209889" AND USD >=50)
)
)


OR
(
 CRD_CLNT_ID  = "SC_C400GH_CR" AND
(
(COMPRESS(MER_ID) = "000000000209364" AND USD >=15 )
)
)

OR
(
 CRD_CLNT_ID  = "SC_C400JO_CR" AND
(
(COMPRESS(MER_ID) = "024795000023408" AND USD >= 2000 )
)
)

OR
(
 CRD_CLNT_ID  = "SC_C400LK_CR" AND
(
(COMPRESS(MER_ID) = "000445534622995" AND  FRD_SCOR  >=400 )
)
)
)
)
THEN HR_MID_Amount_NonMajor_Test = "Y";
RUN;

DATA TXN_DATA;
SET TXN_DATA_SAS;
WHERE HR_MID_Amount_NonMajor_Test = "Y" and date1 GE "03DEC2021"D;
RUN;


DATA RULE_DATA;
SET 
INC.falt003_cr_03dec
INC.falt003_cr_04dec;
WHERE UPCASE(RULE_NAME_STRG) IN ('HR_MID_AMOUNT_NONMAJOR_TEST') and date1 GE "03DEC2021"D;
RUN;

PROC SORT DATA=RULE_DATA NODUPKEY; BY RULE_NAME_STRG FI_TRANSACTION_ID; RUN;

PROC FREQ DATA=TXN_DATA;TITLE "HR_MID_Amount_NonMajor_Test SAS";
TABLE CRD_CLNT_ID*DATE1/NOCOL NOROW NOPERCENT NOCUM; RUN; 
PROC FREQ DATA=RULE_DATA; TITLE "HR_MID_Amount_NonMajor_Test FALCON";
TABLE CLIENT_XID*DATE1/NOCOL NOROW NOPERCENT NOCUM; RUN; 

/* Writing Output to Excel - For Audit*/

ods listing;
ods excel file='C:\Users\1510806\OneDrive - Standard Chartered Bank\Desktop\SAS\Outputs\HR_MID_Amount_NonMajor_Test Global Credit.xlsx'
 options(sheet_interval="NONE");
 ods excel options(sheet_name="OUTPUT");
 PROC FREQ DATA = TXN_DATA;TITLE "HR_MID_Amount_NonMajor_Test SAS";
TABLE CRD_CLNT_ID*DATE1/NOCOL NOROW NOPERCENT NOCUM; RUN; 
PROC FREQ DATA = RULE_DATA; TITLE "HR_MID_Amount_NonMajor_Test FALCON";
TABLE CLIENT_XID*DATE1/NOCOL NOROW NOPERCENT NOCUM; RUN;
ods excel close;
ods listing close;

PROC EXPORT DATA= TXN_DATA
outfile= "C:\Users\1510806\OneDrive - Standard Chartered Bank\Desktop\SAS\Outputs\HR_MID_Amount_NonMajor_Test Global Credit.xlsx"
dbms=xlsx replace;
sheet="TXN_DATA";
run;

PROC EXPORT DATA= RULE_DATA
outfile= "C:\Users\1510806\OneDrive - Standard Chartered Bank\Desktop\SAS\Outputs\HR_MID_Amount_NonMajor_Test Global Credit.xlsx"
dbms=xlsx replace;
sheet="RULE_DATA";
run;
