
LIBNAME CR "C:\Users\1510806\OneDrive - Standard Chartered Bank\Desktop\Jhilam\Consolidated Last 3 Months Data\Nov21";
/*LIBNAME INC "C:\Users\1510806\OneDrive - Standard Chartered Bank\Desktop\Jhilam\Daily Data\CR";*/
/*LIBNAME CR1 "C:\Users\1510806\OneDrive - Standard Chartered Bank\Desktop\Jhilam\Consolidated Last 3 Months Data\Nov21_Major\MAJOR_COUNTRIES_DATA";*/
/*LIBNAME EXIST "C:\Users\1510806\OneDrive - Standard Chartered Bank\Desktop\Jhilam\Falcon 6.4 Monthly Data";*/

****** Pulling FRD15 file ***********;

/*proc sort data=exist.frd15 out=frd15 nodupkey; */
/*by pan fiTransactionIdReference; */
/*run;*/

******* For Credit *********;


/*PROC IMPORT DATAFILE="C:\Users\1510806\OneDrive - Standard Chartered Bank\Desktop\Mer_Id_Analysis.XLSX"*/
/*OUT=FALT002 DBMS=XLSX REPLACE;RUN;*/


data FALT002;
     set 
CR.last_3_months_data_db_major (DROP =  EXTERNAL_1_SCR EXTERNAL_2_SCR EXTERNAL_3_SCR INCOME_AMT PAYMENT_DELINQUENT_CYC)
CR.last_3_months_data_db_Non_Major (DROP =  EXTERNAL_1_SCR EXTERNAL_2_SCR EXTERNAL_3_SCR INCOME_AMT PAYMENT_DELINQUENT_CYC);

/*CR.last_3_months_data_db (DROP =  EXTERNAL_1_SCR EXTERNAL_2_SCR EXTERNAL_3_SCR INCOME_AMT PAYMENT_DELINQUENT_CYC);*/
where 
UPCASE(strip(mer_id)) in (
'477702000203601'
'418889000200232'
'477388000200571'
'9069282'
'011447712'
'970303052883000'
'000019147470017'
'000000000205717'
'174015614'
'4BOVJPA8R0GJ0HM'
'526567000207899'
'246420000395566'
'000001070030477'
'4556344955'
'8492977'
'Z3JI9D2LZGSQN4W'
'PWO63CQLELWG98W'
'6331RSBNBIQZXC0'
'3775889'
'000445384817992'
'332681568'
'ZBCF4AZ8RYUOSTB'
'260871000202167'
'260871000202167'
'498750000011107'
'46212222'
'2101659449'
'5502383'
'000102007919421'
'420429000283189'
'Z5VOILYQSSRCE8J'
'8002232810'
'001903991008'
'000844010106889'
'210758000200925'
'555348801'
'526567000790225'
'020413599'
'230120000202697'
'0030209381963'
'000311021521886'
'000001080041023'
'518898000200596'
'000000000240225'
'024795000023408'
'419100065620000'
'0030201453760'
'023178000167901'
'000311169653889'
'000203065101917'
'2101703971'
'168168329727'
'498750000749433'
'000980200425992'
'414886000167901'
'CF6GT5OZX8ZRXMK'
'477715000217058'
'477713000201297'
'477713000201271'
'20088765'
'Y32QGNNV5ODATVC'
'9NQ6NUKTGM2CQYI'
'P3CVJKPXC8HERAU'
'000000000207696'
'693Y60VURGXSMLS'
'000000000207696'
'LF2K6AOYUOCVOSX'
'000000000207226'
'000001500049069'
'470000087002873'
'526567000233234'
'212963000200925'
'846314000'
'187841509'
'187841509'
'18018313'
'000008074890'
)
and trn_auth_post = "A";
/*and CRD_CLNT_ID in ("SC_CCMSTW_CR" "SC_TANDEMTW_DB");*/
run;


DATA FALT002;
     SET FALT002;
   
/*     WHERE TRN_AUTH_POST="A" AND (AUTH_DECISION_XCD="A" OR DECI_CD_ORIG="A") AND TRN_TYP IN ("C" "M" "P");*/

     FORMAT TRAN_DATE DATE9.;
/*     TRAN_DATE = INPUT(SUBSTR(TRN_DT,1,2) || SUBSTR(TRN_DT,4,3) || '20' || SUBSTR(TRN_DT,8,2),DATE9.);*/
/*     ATTRIB AUTH_DTTM FORMAT=DATETIME19.;*/
/*     AUTH_DTTM=DHMS(TRAN_DATE,SUBSTR(TRN_DT,11,2),SUBSTR(TRN_DT,14,2),SUBSTR(TRN_DT,17,2)); */
	 COUNTRY = CRD_CLNT_ID;

	 OUTPUT;
	 IF CRD_CLNT_ID NE "" THEN DO; COUNTRY = "ALL"; OUTPUT; END;
RUN;


PROC SQL;
CREATE TABLE db_Impact_Summary AS 
SELECT DISTINCT mer_id, mer_nm, COUNTRY, 
		COUNT(DISTINCT FI_TRANSACTION_ID) AS TXN_COUNT, 
		COUNT(DISTINCT ACCT_NBR) AS ACCT_COUNT, 
		SUM(FRAUD) AS NO_OF_FRAUDS,
		COUNT(DISTINCT CASE WHEN FRAUD=1 THEN ACCT_NBR END) AS NO_OF_CARDS_FRAUD, 
		CASE 
		 WHEN SUM(FRAUD) NE . THEN CALCULATED TXN_COUNT/CALCULATED NO_OF_FRAUDS
		 ELSE CALCULATED TXN_COUNT
		END AS TFPR,
		CASE 
		 WHEN SUM(FRAUD) NE . THEN CALCULATED ACCT_COUNT/CALCULATED NO_OF_CARDS_FRAUD
		 ELSE CALCULATED ACCT_COUNT
		END AS AFPR,
		ROUND(CALCULATED ACCT_COUNT/90,1) AS IMPACT_PER_DAY
FROM FALT002
group by mer_id, mer_nm, COUNTRY;
QUIT;





PROC SQL;
Create table xxx as
Select distinct mer_id, mer_nm
from FALT002 where
mer_id in 
(
'000001080041023',
'011447712',
'18018313',
'187841509',
'2101659449',
'260871000202167',
'332681568',
'419100065620000',
'4556344955',
'46212222',
'477702000203601',
'526567000207899',
'526567000233234',
'8492977',
'970303052883000',
'LF2K6AOYUOCVOSX');
RUN;
